{% extends "_base_page.html" %}

{% block page_title %}Your response to ‘{{ brief.title }}’ - Digital Marketplace{% endblock %}

{% block breadcrumb %}

  {%
    with items = [
      {
        "link": "/",
        "label": "Digital Marketplace"
      },
      {
        "link": url_for("external.buyer_frontend_get_brief_by_id", framework_framework=brief.frameworkFramework, brief_id=brief.id),
        "label": "{}".format(brief.title)
      },
    ]
  %}
    {% include "toolkit/breadcrumb.html" %}
  {% endwith %}
{% endblock %}

{% block main_content %}

{# Messages #}
{% with messages = get_flashed_messages(with_categories=True) %}

    {# Flash messages/ application update handling/ default #}
    {% for category, message in messages %}
      {% if message == "application_updated" %}
        {%
          with
          message = "Your application has been updated.",
          type = "success"
        %}
          {% include "toolkit/notification-banner.html" %}
        {% endwith %}
      {% else %}
        {%
        with
        message = message,
        type = "destructive-without-action" if category == "error" else category
        %}
          {% include "toolkit/notification-banner.html" %}
        {% endwith %}
      {% endif %}
    {% endfor %}

{% endwith %}

<div class="grid-row">
  <div class="column-two-thirds">
    {% with
      heading = "Check your answers" if brief_response.status == 'draft' else "Your application for ‘{}’".format(brief.title),
      smaller = true
      %}
        {% include 'toolkit/page-heading.html' %}
    {% endwith %}

    <div class="dmspeak">
      {% if brief_response.status == 'submitted' %}
      <p>
        <a href="{{ url_for('external.buyer_frontend_get_brief_by_id', framework_framework='digital-outcomes-and-specialists', brief_id=brief.id) }}">View the opportunity{{ ' and its outcome' if brief.status in ["awarded", "cancelled", "unsuccessful"] }}</a>
      </p>
      {% endif %}
    </div>
  </div>
</div>

<div class="grid-row">
  <div class="column-one-whole">
    {% with show_edit_links = (brief.status == 'live') %}
      {% include 'briefs/_brief_response_data.html' %}
    {% endwith %}
  </div>
</div>

<p class="padding-bottom-small">&nbsp;</p>

{% if brief_response.status == 'draft' and brief.status == 'live' %}
<div class="grid-row">
    <div class="column-two-thirds">
      <form action="{{ url_for('.check_brief_response_answers', brief_id=brief.id, brief_response_id=brief_response.id) }}" method="post">
        <p>Once you submit you can update your application until {{ brief.applicationsClosedAt|utcdatetimeformat }}.</p>
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        {%
          with
          label="Submit application",
          type="save"
        %}
          {% include "toolkit/button.html" %}
        {% endwith %}
      </form>
    </div>
  </div>
{% endif %}

  {% endblock %}
